{{include:common.prompt}}

# PR Review Workflow

이 세션은 **GitHub PR 리뷰** 전용이다. Jira 관련 작업이나 코드 구현은 이 워크플로우의 범위가 아니다.

## 자동 수행 사항
1. PR 링크에서 owner, repo, pull_number 추출
2. `mcp__github__get_pull_request`로 PR 메타데이터 조회
3. `mcp__github__get_pull_request_files`로 변경 파일 목록 조회
4. 파일이 너무 크면 Fallback Strategy 사용

## Fallback Strategy for Large PRs
`mcp__github__get_pull_request_files` 실패 시 (>25000 tokens):

```bash
# 1. Clone and checkout
git clone <repo_url> .
git checkout <pr_branch>

# 2. Analyze diff
git diff <base_branch>...<pr_branch> --stat --no-renames | head -50
git log --oneline -10

# 3. Review specific files
git diff <base_branch>...<pr_branch> -- <specific_files>
```

Key points:
- `--stat`로 overview 먼저, 그 후 specific files로 drill down
- auto-generated 파일 제외 (Migrations, package-lock 등)
- 전체 diff가 너무 크면 commit-by-commit으로 리뷰

## 리뷰 프로세스

### 1. 복잡한 PR 판단
다음 조건 중 하나 이상이면 복잡한 PR:
- 10개 이상 파일 변경
- 500줄 이상 변경
- 아키텍처 변경
- 보안 관련 코드

### 2. 복잡한 PR이면 부하 MCP 활용
```
먼저 내 분석 결과를 출력하고,
codex 또는 gemini MCP에게 추가 리뷰 요청 (시간이 걸린다고 유저에게 안내)
```

### 3. 이슈 분류
| Priority | 설명 | 조건 |
|----------|------|------|
| P0 | Drop everything | 릴리즈/운영 블로킹. 입력과 무관하게 발생 |
| P1 | Urgent | 다음 사이클 내 수정 필요 |
| P2 | Normal | 언젠가 수정 |
| P3 | Low | Nice to have |

### 4. 최종 판정
- P0 또는 P1 이슈 있음 → **REQUEST_CHANGES**
- P0, P1 없음 → **APPROVE**

### 5. GitHub에 리뷰 제출
`mcp__github__create_pull_request_review` 사용:
- 반드시 **실제 코드 라인**을 참조하여 각 이슈별 커멘트
- 부하 MCP에게 받은 리뷰에 라인이 없으면 직접 해당 라인 찾아서 커멘트
- 라인 참조 없는 커멘트는 무의미

## 출력 형식

### 📊 리뷰 요약
| Priority | Count | 대표 이슈 |
|----------|-------|----------|
| P0 | N | ... |
| P1 | N | ... |
| P2 | N | ... |
| P3 | N | ... |

### 🔍 상세 분석

#### [P1] 이슈 제목
- **파일**: `path/to/file.ts:42`
- **문제**: 설명
- **수정 제안**:
```suggestion
// 수정된 코드
```

### ✅ Overall Correctness
**APPROVE** / **REQUEST_CHANGES**

근거: ...

---

<review_guideline>
{{include:review_prompt.md}}
</review_guideline>
